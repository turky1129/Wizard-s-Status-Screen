<!doctype html><html lang="ja"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>NW キャラクターメイキング 完全版</title><style>
:root{--bg:#0e1116;--panel-bg:#252b38;--line:rgba(255,255,255,.10);--line2:rgba(255,255,255,.18);--text:rgba(255,255,255,.92);--muted:rgba(255,255,255,.66);--accent:#7cf0ff;--accent2:#b8ff6a;--danger:#ff6a7a;--shadow:0 16px 40px rgba(0,0,0,.45);--radius:16px;--radius2:12px}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Yu Gothic",sans-serif;background:radial-gradient(1400px 900px at 20% 10%, rgba(124,240,255,.10), transparent 55%),radial-gradient(1200px 900px at 80% 0%, rgba(184,255,106,.08), transparent 50%),var(--bg);color:var(--text)}
.wrap{max-width:1560px;margin:0 auto;padding:18px 20px 24px}
.topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:14px;flex-wrap:wrap}
.title{display:flex;align-items:baseline;gap:10px;font-weight:800;letter-spacing:.02em}
.header-controls{display:flex;align-items:center;gap:12px;flex-grow:1;justify-content:flex-end}

/* グリッドとセクションの幅制限 */
.grid{display:grid;grid-template-columns:480px 1fr;gap:14px;align-items:start}
section{min-width: 0}

.panel{background:linear-gradient(180deg, rgba(40,50,70,.55), rgba(20,25,40,.55));border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin-bottom:14px;width:100%}
.panel .bd{padding:14px;width:100%;overflow:hidden}

.portraitBox{width:100%;aspect-ratio:6/5;border-radius:var(--radius2);border:1px solid var(--line2);background:rgba(255,255,255,.02);position:relative;overflow:hidden;cursor:pointer}
.portraitBox img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.btnRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{border:1px solid var(--line2);background:rgba(255,255,255,0.04);color:var(--text);padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;transition:all .15s ease;white-space:nowrap;display:inline-flex;align-items:center;justify-content:center}
button:hover{background:rgba(255,255,255,0.1)}
button.primary{border-color:var(--accent);background:rgba(124,240,255,0.1)}
button.danger{border-color:var(--danger);background:rgba(255,106,122,0.1)}
button.icon-btn{padding:4px;width:28px;height:28px;border-radius:8px;font-size:16px}
button.toggle-on{background:var(--accent2);color:#000;border-color:var(--accent2)}
.sField{display:flex;flex-direction:column;gap:6px;min-width:0}
.sField label{font-size:11px;color:var(--muted)}
.sField input,.sField select,.sField textarea{width:100%;border:1px solid var(--line2);background:rgba(0,0,0,0.3);color:var(--text);padding:9px 10px;border-radius:12px;outline:none}
.lvl-info{display:flex;flex-direction:column;gap:4px;background:rgba(124,240,255,0.1);padding:6px 12px;border-radius:12px;border:1px solid rgba(124,240,255,0.3);min-width:80px;align-items:center}
.lvl-info label{font-size:10px;color:var(--accent);font-weight:800}
.lvl-info b{font-size:22px}

.sectionTitle{display:flex;align-items:center;width:100%;font-weight:700;padding:12px 14px;color:var(--muted);background:rgba(255,255,255,0.03);cursor:pointer;user-select:none;border-bottom:1px solid var(--line)}
.sectionTitle .label-text{display:flex;align-items:center}
.sectionTitle .label-text::before{content:attr(data-icon);margin-right:8px;color:var(--accent);font-size:10px;width:12px}

.summary-chips{display:flex;gap:8px;overflow-x:auto;padding:2px 0;margin-left:12px;scrollbar-width:none;flex-grow:1}
.chip{font-size:14px;padding:4px 10px;background:rgba(255,255,255,0.1);border-radius:6px;white-space:nowrap;color:var(--text);border:1px solid var(--line)}
.chip b{color:var(--accent2);margin-left:4px;font-size:16px}

.tableWrap{width:100%;display:block;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,0.15);overflow-x:auto}

table{width:100%;border-collapse:separate;border-spacing:0;font-size:13px}
th,td{border-bottom:1px solid var(--line);border-right:1px solid var(--line);padding:7px 8px;vertical-align:middle;white-space:nowrap}
th{color:var(--muted);background:rgba(255,255,255,0.03);font-weight:800}
.numIn{width:56px;border:1px solid var(--line2);background:rgba(0,0,0,0.18);color:var(--text);padding:6px 7px;border-radius:10px;outline:none;text-align:right}
.numOut{min-width:42px;display:inline-block;text-align:right;padding:5px 7px;border-radius:10px;border:1px solid var(--line);background:rgba(0,0,0,0.2)}
.cellInput{width:100%;border:1px solid var(--line2);background:rgba(0,0,0,0.18);color:var(--text);padding:6px 7px;border-radius:8px;outline:none}
.cellSelect{width:100%;border:1px solid var(--line2);background:rgba(0,0,0,0.18);color:var(--text);padding:6px 2px;border-radius:8px;outline:none}
.sort-controls{display:flex;gap:2px}
.sort-btn{padding:2px 4px;font-size:10px;min-width:24px;border-radius:4px;background:rgba(255,255,255,0.05)}

/* 固定列 */
.sticky-col {position:sticky;z-index:10;background:var(--panel-bg)}
th.sticky-col {background:#2f3542;z-index:11}
.col-fix-0 {left:0;width:40px}
.col-fix-1 {left:40px;width:180px}
.col-fix-2 {left:220px;width:80px}
.col-fix-3 {left:300px;width:100px;box-shadow:4px 0 10px rgba(0,0,0,0.5);border-right:1px solid var(--line)}

.cap-stats {display:flex;gap:10px;margin-left:14px;font-size:13px;color:var(--text)}
.cap-item {background:rgba(0,0,0,0.4);padding:4px 12px;border-radius:8px;border:1px solid var(--line);display:flex;align-items:center;gap:6px}
.cap-item span {color:var(--muted);font-size:11px;font-weight:800}
.cap-item b {color:var(--accent);font-size:16px;letter-spacing:0.02em}
.cap-item.over b {color:var(--danger)}
.cap-max {font-size:12px;color:var(--muted);margin-left:-2px}

@media (max-width:1200px){.grid{grid-template-columns:1fr}}
</style></head><body>
<div id="app" class="wrap">
  <div class="topbar">
    <div class="title"><div>NW キャラクターメイキング</div><small>COMPLETE</small></div>
    <div class="header-controls">
      <div class="sField" style="width:120px"><label>PL名</label><input v-model="meta.plName" placeholder="PL名"/></div>
      <div class="sField" style="width:120px"><label>Password</label><input v-model="meta.password" type="password" placeholder="****"/></div>
      <button class="primary" @click="dummyAction('保存しました')">保存</button>
      <button class="danger" @click="resetData">削除</button>
    </div>
  </div>

  <div class="grid">
    <section>
      <div class="panel">
        <div class="sectionTitle" @click="ui.showBasic = !ui.showBasic">
          <div class="label-text" :data-icon="ui.showBasic ? '▼':'▶'">基本情報</div>
        </div>
        <div class="bd" v-show="ui.showBasic">
          <div class="portraitBox" @click="pickImage"><img v-if="portraitUrl" :src="portraitUrl"/><div v-else style="text-align:center;padding-top:20%;color:var(--muted)">画像を選択</div></div>
          <input ref="fileEl" type="file" @change="onFileChange" hidden/>
          
          <div style="display:grid;grid-template-columns:1fr 100px;gap:10px;margin-top:12px;align-items:end">
            <div class="sField"><label>キャラクター名</label><input v-model="meta.name"/></div>
            <div class="lvl-info"><label>TOTAL LV</label><b>{{totalLevel}}</b></div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
            <div class="sField"><label>属性</label><select v-model="meta.element"><option v-for="k in elementKeys">{{k}}</option></select></div>
            <div class="sField"><label>移動力</label><div class="numOut" style="width:100%">{{equipped.move}}</div></div>
            <div class="sField"><label>WC</label><select v-model="meta.wclass"><option v-for="k in wClassKeys">{{k}}</option></select></div>
            <div class="sField"><label>WC Lv</label><input type="text" :value="meta.wlv" @input="e => meta.wlv = convNum(e.target.value)" class="numIn" style="width:100%"/></div>
            <div class="sField"><label>SC</label><select v-model="meta.sclass"><option v-for="k in sClassKeys">{{k}}</option></select></div>
            <div class="sField"><label>SC Lv</label><input type="text" :value="meta.slv" @input="e => meta.slv = convNum(e.target.value)" class="numIn" style="width:100%"/></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="sectionTitle" @click="ui.showPers = !ui.showPers">
          <div class="label-text" :data-icon="ui.showPers ? '▼':'▶'">パーソナリティ</div>
        </div>
        <div class="bd" v-show="ui.showPers">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="sField"><label>種族</label><input v-model="pers.race"/></div>
            <div class="sField"><label>二つ名</label><input v-model="pers.alias"/></div>
            <div class="sField" style="grid-column:span 2"><label>ワークス</label><input v-model="pers.works"/></div>
            <div class="sField" style="grid-column:span 2"><label>メモ</label><textarea v-model="pers.freeField" style="height:80px;resize:none"></textarea></div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="panel">
        <div class="sectionTitle" @click="ui.showAbi = !ui.showAbi">
          <div class="label-text" :data-icon="ui.showAbi ? '▼':'▶'">能力値</div>
          <div class="summary-chips" v-show="!ui.showAbi">
            <span class="chip" v-for="k in abiKeys">{{abiNames[k]}}<b>{{abiTotal(k)}}</b></span>
            <span class="chip">内包<b>{{pranaTotal('inner')}}</b></span>
            <span class="chip">解放<b>{{pranaTotal('release')}}</b></span>
            <span class="chip">CF修正<b>{{pranaTotal('cf')}}</b></span>
          </div>
        </div>
        <div class="bd" v-show="ui.showAbi">
          <div class="tableWrap"><table>
            <thead><tr><th>区分</th><th v-for="k in abiKeys">{{abiNames[k]}}</th><th>内包</th><th>解放</th><th>CF修正</th></tr></thead>
            <tbody>
              <tr><td>ベース</td><td v-for="k in abiKeys"><input class="numIn" :value="abi[k].base" @input="e => abi[k].base = convNum(e.target.value)"/></td><td><input class="numIn" :value="prana.innerBase" @input="e => prana.innerBase = convNum(e.target.value)"/></td><td><input class="numIn" :value="prana.releaseBase" @input="e => prana.releaseBase = convNum(e.target.value)"/></td><td><input class="numIn" readonly :value="cfBase" style="opacity:0.5"/></td></tr>
              <tr><td>修正</td><td v-for="k in abiKeys"><input class="numIn" :value="abi[k].mod" @input="e => abi[k].mod = convNum(e.target.value)"/></td><td><input class="numIn" :value="prana.innerMod" @input="e => prana.innerMod = convNum(e.target.value)"/></td><td><input class="numIn" :value="prana.releaseMod" @input="e => prana.releaseMod = convNum(e.target.value)"/></td><td><input class="numIn" :value="prana.cfMod" @input="e => prana.cfMod = convNum(e.target.value)"/></td></tr>
              <tr style="background:rgba(124,240,255,0.12);font-weight:800"><td>合計</td><td v-for="k in abiKeys" style="color:var(--accent2)">{{abiTotal(k)}}</td><td style="color:var(--accent2)">{{pranaTotal('inner')}}</td><td style="color:var(--accent2)">{{pranaTotal('release')}}</td><td style="color:var(--accent2)">{{pranaTotal('cf')}}</td></tr>
            </tbody>
          </table></div>
        </div>
      </div>

      <div class="panel">
        <div class="sectionTitle" @click="ui.showCombat = !ui.showCombat">
          <div class="label-text" :data-icon="ui.showCombat ? '▼':'▶'">戦闘値</div>
          <div class="summary-chips" v-show="!ui.showCombat">
            <span class="chip" v-for="k in combatKeys">{{combatLabels[k]}}<b>{{equipped[k]}}</b></span>
          </div>
        </div>
        <div class="bd" v-show="ui.showCombat">
          <div class="tableWrap"><table>
            <thead><tr><th>区分</th><th v-for="k in combatKeys">{{combatLabels[k]}}</th></tr></thead>
            <tbody>
              <tr><td>ベース(能力+クラス)</td><td v-for="k in combatKeys"><div class="numOut" style="width:100%">{{baseCombat[k]}}</div></td></tr>
              <tr><td>特殊修正</td><td v-for="k in combatKeys"><input class="numIn" :value="combat.skill[k]" @input="e => combat.skill[k] = convNum(e.target.value)"/></td></tr>
              <tr style="background:rgba(184,255,106,0.12);font-weight:800"><td>装備込</td><td v-for="k in combatKeys" style="color:var(--accent2)">{{equipped[k]}}</td></tr>
            </tbody>
          </table></div>
        </div>
      </div>

      <div class="panel">
        <div class="sectionTitle">
          <div class="label-text" @click="ui.showEquip = !ui.showEquip" :data-icon="ui.showEquip ? '▼':'▶'">装備・月衣</div>
          <div class="cap-stats">
            <div :class="['cap-item', {over: equipCaps.currentWeight > equipCaps.maxWeight}]"><span>重量</span><b>{{equipCaps.currentWeight}}</b><span class="cap-max">/{{equipCaps.maxWeight}}</span></div>
            <div :class="['cap-item', {over: equipCaps.currentMem > equipCaps.maxMem}]"><span>記憶</span><b>{{equipCaps.currentMem}}</b><span class="cap-max">/{{equipCaps.maxMem}}</span></div>
            <div :class="['cap-item', {over: equipCaps.currentTsuki > equipCaps.maxTsuki}]"><span>月衣</span><b>{{equipCaps.currentTsuki}}</b><span class="cap-max">/{{equipCaps.maxTsuki}}</span></div>
          </div>
          <div style="flex-grow:1"></div>
          <div class="btnRow">
            <button class="icon-btn primary" title="行追加" @click="addRow(equips, 'equip')">＋</button>
            <button class="icon-btn danger" title="最下行削除" @click="removeLast(equips)" :disabled="equips.length<=1">×</button>
            <button :class="['icon-btn', {'toggle-on': ui.sortEquip}]" title="並べ替え" @click="ui.sortEquip = !ui.sortEquip">⇅</button>
          </div>
        </div>
        <div class="bd" v-show="ui.showEquip">
          <div class="tableWrap"><table style="min-width:1300px">
            <thead>
              <tr>
                <th class="sticky-col col-fix-0">装</th>
                <th class="sticky-col col-fix-1">名称</th>
                <th class="sticky-col col-fix-2">種別</th>
                <th class="sticky-col col-fix-3">部位</th>
                <th style="width:60px">重量</th>
                <th v-for="k in combatKeys">{{combatLabels[k]}}</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(r, idx) in equips" :key="r._k">
                <td class="sticky-col col-fix-0">
                  <div v-if="ui.sortEquip" class="sort-controls">
                    <button class="sort-btn" @click="moveRow(equips, idx, -1)" :disabled="idx===0">↑</button>
                    <button class="sort-btn" @click="moveRow(equips, idx, 1)" :disabled="idx===equips.length-1">↓</button>
                  </div>
                  <input v-else type="checkbox" v-model="r.equipped"/>
                </td>
                <td class="sticky-col col-fix-1"><input class="cellInput" v-model="r.name"/></td>
                <td class="sticky-col col-fix-2">
                  <select class="cellSelect" v-model="r.type">
                    <option v-for="t in equipTypes" :value="t">{{t}}</option>
                  </select>
                </td>
                <td class="sticky-col col-fix-3"><input class="cellInput" v-model="r.part"/></td>
                <td><input class="numIn" style="width:100%" :value="r.weight" @input="e => r.weight = convNum(e.target.value)"/></td>
                <td v-for="k in combatKeys"><input class="numIn" style="width:100%" :value="r[k]" @input="e => r[k] = convNum(e.target.value)"/></td>
              </tr>
            </tbody>
          </table></div>
        </div>
      </div>

      <div class="panel">
        <div class="sectionTitle">
          <div class="label-text" @click="ui.showSkill = !ui.showSkill" :data-icon="ui.showSkill ? '▼':'▶'">特殊能力</div>
          <div style="flex-grow:1"></div>
          <div class="btnRow">
            <button class="icon-btn primary" title="行追加" @click="addRow(skills, 'skill')">＋</button>
            <button class="icon-btn danger" title="最下行削除" @click="removeLast(skills)" :disabled="skills.length<=1">×</button>
            <button :class="['icon-btn', {'toggle-on': ui.sortSkill}]" title="並べ替え" @click="ui.sortSkill = !ui.sortSkill">⇅</button>
          </div>
        </div>
        <div class="bd" v-show="ui.showSkill">
          <div class="tableWrap"><table style="min-width:1000px">
            <thead><tr><th v-if="ui.sortSkill" style="width:50px">移動</th><th>名称</th><th style="width:50px">SL</th><th>タイミング</th><th>判定値</th><th>対象</th><th>射程</th><th>代償</th><th>効果</th></tr></thead>
            <tbody>
              <tr v-for="(s, idx) in skills" :key="s._k">
                <td v-if="ui.sortSkill">
                  <div class="sort-controls">
                    <button class="sort-btn" @click="moveRow(skills, idx, -1)" :disabled="idx===0">↑</button>
                    <button class="sort-btn" @click="moveRow(skills, idx, 1)" :disabled="idx===skills.length-1">↓</button>
                  </div>
                </td>
                <td><input class="cellInput" v-model="s.name"/></td>
                <td><input class="numIn" style="width:100%" :value="s.sl" @input="e => s.sl = convNum(e.target.value)"/></td>
                <td><input class="cellInput" v-model="s.timing"/></td>
                <td><input class="cellInput" v-model="s.judge"/></td>
                <td><input class="cellInput" v-model="s.target"/></td>
                <td><input class="cellInput" v-model="s.range"/></td>
                <td><input class="cellInput" v-model="s.cost"/></td>
                <td><input class="cellInput" v-model="s.effect"/></td>
              </tr>
            </tbody>
          </table></div>
        </div>
      </div>
    </section>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
const{createApp,reactive,ref,computed,watch}=Vue;

// Data definitions
const ATTR_DATA = {"天／天": {"stats": {"str": 5, "dex": 6, "agi": 5, "mnd": 8, "int": 8, "fai": 12, "per": 6, "luk": 13}, "base": {"hp": 12, "mp": 20}}, "天／冥": {"stats": {"str": 6, "dex": 7, "agi": 5, "mnd": 9, "int": 10, "fai": 10, "per": 6, "luk": 10}, "base": {"hp": 13, "mp": 17}}, "天／地": {"stats": {"str": 8, "dex": 6, "agi": 4, "mnd": 9, "int": 7, "fai": 11, "per": 7, "luk": 11}, "base": {"hp": 15, "mp": 16}}, "天／水": {"stats": {"str": 5, "dex": 7, "agi": 6, "mnd": 9, "int": 9, "fai": 11, "per": 6, "luk": 10}, "base": {"hp": 12, "mp": 17}}, "天／火": {"stats": {"str": 8, "dex": 8, "agi": 5, "mnd": 7, "int": 7, "fai": 10, "per": 7, "luk": 11}, "base": {"hp": 15, "mp": 15}}, "天／風": {"stats": {"str": 6, "dex": 9, "agi": 4, "mnd": 8, "int": 8, "fai": 10, "per": 8, "luk": 10}, "base": {"hp": 13, "mp": 16}}, "天／虚": {"stats": {"str": 5, "dex": 7, "agi": 5, "mnd": 10, "int": 7, "fai": 10, "per": 7, "luk": 12}, "base": {"hp": 12, "mp": 15}}, "冥／天": {"stats": {"str": 6, "dex": 8, "agi": 7, "mnd": 11, "int": 11, "fai": 6, "per": 6, "luk": 8}, "base": {"hp": 13, "mp": 15}}, "冥／冥": {"stats": {"str": 7, "dex": 9, "agi": 7, "mnd": 12, "int": 13, "fai": 4, "per": 6, "luk": 5}, "base": {"hp": 14, "mp": 18}}, "冥／地": {"stats": {"str": 9, "dex": 8, "agi": 6, "mnd": 12, "int": 10, "fai": 5, "per": 7, "luk": 6}, "base": {"hp": 16, "mp": 14}}, "冥／水": {"stats": {"str": 6, "dex": 9, "agi": 8, "mnd": 12, "int": 12, "fai": 5, "per": 6, "luk": 5}, "base": {"hp": 13, "mp": 15}}, "冥／火": {"stats": {"str": 9, "dex": 10, "agi": 7, "mnd": 10, "int": 10, "fai": 4, "per": 7, "luk": 6}, "base": {"hp": 16, "mp": 14}}, "冥／風": {"stats": {"str": 7, "dex": 11, "agi": 6, "mnd": 11, "int": 11, "fai": 4, "per": 8, "luk": 5}, "base": {"hp": 14, "mp": 14}}, "冥／虚": {"stats": {"str": 6, "dex": 9, "agi": 7, "mnd": 13, "int": 10, "fai": 4, "per": 7, "luk": 7}, "base": {"hp": 13, "mp": 14}}, "地／天": {"stats": {"str": 10, "dex": 6, "agi": 6, "mnd": 11, "int": 6, "fai": 8, "per": 7, "luk": 9}, "base": {"hp": 17, "mp": 14}}, "地／冥": {"stats": {"str": 11, "dex": 7, "agi": 6, "mnd": 12, "int": 8, "fai": 6, "per": 7, "luk": 6}, "base": {"hp": 18, "mp": 14}}, "地／地": {"stats": {"str": 13, "dex": 6, "agi": 5, "mnd": 12, "int": 5, "fai": 7, "per": 8, "luk": 7}, "base": {"hp": 20, "mp": 17}}, "地／水": {"stats": {"str": 10, "dex": 7, "agi": 7, "mnd": 12, "int": 7, "fai": 7, "per": 7, "luk": 6}, "base": {"hp": 17, "mp": 14}}, "地／火": {"stats": {"str": 13, "dex": 8, "agi": 6, "mnd": 10, "int": 5, "fai": 6, "per": 8, "luk": 7}, "base": {"hp": 20, "mp": 12}}, "地／風": {"stats": {"str": 11, "dex": 9, "agi": 5, "mnd": 11, "int": 6, "fai": 6, "per": 9, "luk": 6}, "base": {"hp": 18, "mp": 13}}, "地／虚": {"stats": {"str": 10, "dex": 7, "agi": 6, "mnd": 13, "int": 5, "fai": 6, "per": 8, "luk": 8}, "base": {"hp": 17, "mp": 12}}, "水／天": {"stats": {"str": 5, "dex": 6, "agi": 8, "mnd": 9, "int": 11, "fai": 10, "per": 5, "luk": 9}, "base": {"hp": 12, "mp": 17}}, "水／冥": {"stats": {"str": 6, "dex": 7, "agi": 8, "mnd": 10, "int": 13, "fai": 8, "per": 5, "luk": 6}, "base": {"hp": 13, "mp": 17}}, "水／地": {"stats": {"str": 8, "dex": 6, "agi": 7, "mnd": 10, "int": 10, "fai": 9, "per": 6, "luk": 7}, "base": {"hp": 15, "mp": 16}}, "水／水": {"stats": {"str": 5, "dex": 7, "agi": 9, "mnd": 10, "int": 12, "fai": 9, "per": 5, "luk": 6}, "base": {"hp": 12, "mp": 20}}, "水／火": {"stats": {"str": 8, "dex": 8, "agi": 8, "mnd": 8, "int": 10, "fai": 8, "per": 6, "luk": 7}, "base": {"hp": 15, "mp": 16}}, "水／風": {"stats": {"str": 6, "dex": 9, "agi": 7, "mnd": 9, "int": 11, "fai": 8, "per": 7, "luk": 6}, "base": {"hp": 13, "mp": 16}}, "水／虚": {"stats": {"str": 5, "dex": 7, "agi": 8, "mnd": 11, "int": 10, "fai": 8, "per": 6, "luk": 8}, "base": {"hp": 12, "mp": 16}}, "火／天": {"stats": {"str": 12, "dex": 8, "agi": 8, "mnd": 7, "int": 5, "fai": 7, "per": 7, "luk": 9}, "base": {"hp": 19, "mp": 13}}, "火／冥": {"stats": {"str": 13, "dex": 9, "agi": 8, "mnd": 8, "int": 7, "fai": 5, "per": 7, "luk": 6}, "base": {"hp": 20, "mp": 13}}, "火／地": {"stats": {"str": 15, "dex": 8, "agi": 7, "mnd": 8, "int": 4, "fai": 6, "per": 8, "luk": 7}, "base": {"hp": 22, "mp": 12}}, "火／水": {"stats": {"str": 12, "dex": 9, "agi": 9, "mnd": 8, "int": 6, "fai": 6, "per": 7, "luk": 6}, "base": {"hp": 19, "mp": 13}}, "火／火": {"stats": {"str": 15, "dex": 10, "agi": 8, "mnd": 6, "int": 4, "fai": 5, "per": 8, "luk": 7}, "base": {"hp": 22, "mp": 14}}, "火／風": {"stats": {"str": 13, "dex": 11, "agi": 7, "mnd": 7, "int": 5, "fai": 5, "per": 9, "luk": 6}, "base": {"hp": 20, "mp": 12}}, "火／虚": {"stats": {"str": 12, "dex": 9, "agi": 8, "mnd": 9, "int": 4, "fai": 5, "per": 8, "luk": 8}, "base": {"hp": 19, "mp": 11}}, "風／天": {"stats": {"str": 7, "dex": 10, "agi": 11, "mnd": 7, "int": 7, "fai": 7, "per": 7, "luk": 7}, "base": {"hp": 14, "mp": 14}}, "風／冥": {"stats": {"str": 8, "dex": 11, "agi": 11, "mnd": 8, "int": 9, "fai": 5, "per": 7, "luk": 4}, "base": {"hp": 15, "mp": 14}}, "風／地": {"stats": {"str": 10, "dex": 10, "agi": 10, "mnd": 8, "int": 6, "fai": 6, "per": 8, "luk": 5}, "base": {"hp": 17, "mp": 13}}, "風／水": {"stats": {"str": 7, "dex": 11, "agi": 12, "mnd": 8, "int": 8, "fai": 6, "per": 7, "luk": 4}, "base": {"hp": 14, "mp": 14}}, "風／火": {"stats": {"str": 10, "dex": 12, "agi": 11, "mnd": 6, "int": 6, "fai": 5, "per": 8, "luk": 5}, "base": {"hp": 17, "mp": 12}}, "風／風": {"stats": {"str": 8, "dex": 13, "agi": 10, "mnd": 7, "int": 7, "fai": 5, "per": 9, "luk": 4}, "base": {"hp": 15, "mp": 17}}, "風／虚": {"stats": {"str": 7, "dex": 11, "agi": 11, "mnd": 9, "int": 6, "fai": 5, "per": 8, "luk": 6}, "base": {"hp": 14, "mp": 12}}, "虚／天": {"stats": {"str": 7, "dex": 7, "agi": 11, "mnd": 6, "int": 5, "fai": 6, "per": 8, "luk": 13}, "base": {"hp": 14, "mp": 12}}, "虚／冥": {"stats": {"str": 8, "dex": 8, "agi": 11, "mnd": 7, "int": 7, "fai": 4, "per": 8, "luk": 10}, "base": {"hp": 15, "mp": 12}}, "虚／地": {"stats": {"str": 10, "dex": 7, "agi": 10, "mnd": 7, "int": 4, "fai": 5, "per": 9, "luk": 11}, "base": {"hp": 17, "mp": 11}}, "虚／水": {"stats": {"str": 7, "dex": 8, "agi": 12, "mnd": 7, "int": 6, "fai": 5, "per": 8, "luk": 10}, "base": {"hp": 14, "mp": 12}}, "虚／火": {"stats": {"str": 10, "dex": 9, "agi": 11, "mnd": 5, "int": 4, "fai": 4, "per": 9, "luk": 11}, "base": {"hp": 17, "mp": 11}}, "虚／風": {"stats": {"str": 8, "dex": 10, "agi": 10, "mnd": 6, "int": 5, "fai": 4, "per": 10, "luk": 10}, "base": {"hp": 15, "mp": 11}}, "虚／虚": {"stats": {"str": 7, "dex": 8, "agi": 11, "mnd": 8, "int": 4, "fai": 4, "per": 9, "luk": 12}, "base": {"hp": 14, "mp": 14}}};
const STYLE_DATA = {"アタッカー": {"hit": 3, "atk": 4, "mag": 0, "matk": 0, "eva": 2, "def": 2, "res": 0, "mdef": 0, "act": 2, "hp": 5, "mp": 2}, "キャスター": {"hit": 0, "atk": 0, "mag": 3, "matk": 4, "eva": 0, "def": 0, "res": 2, "mdef": 2, "act": 2, "hp": 2, "mp": 5}, "ディフェンダー": {"hit": 2, "atk": 2, "mag": 2, "matk": 0, "eva": 0, "def": 4, "res": 0, "mdef": 3, "act": 0, "hp": 6, "mp": 1}, "ヒーラー": {"hit": 2, "atk": 0, "mag": 3, "matk": 2, "eva": 0, "def": 2, "res": 1, "mdef": 3, "act": 0, "hp": 3, "mp": 4}};
const CLASS_DATA = {"異能者": {"hit": 2, "atk": 2, "mag": 3, "matk": 2, "eva": 2, "def": 0, "res": 2, "mdef": 0, "act": 0, "hp": 3, "mp": 4}, "大いなる者": {"hit": 2, "atk": 2, "mag": 3, "matk": 3, "eva": 0, "def": 0, "res": 2, "mdef": 1, "act": 0, "hp": 3, "mp": 4}, "落とし子": {"hit": 3, "atk": 3, "mag": 3, "matk": 3, "eva": 0, "def": 0, "res": 0, "mdef": 0, "act": 1, "hp": 5, "mp": 2}, "陰陽師": {"hit": 0, "atk": 0, "mag": 2, "matk": 2, "eva": 2, "def": 0, "res": 3, "mdef": 4, "act": 0, "hp": 2, "mp": 5}, "吸血鬼": {"hit": 2, "atk": 2, "mag": 2, "matk": 3, "eva": 0, "def": 0, "res": 2, "mdef": 2, "act": 0, "hp": 4, "mp": 3}, "強化人間": {"hit": 4, "atk": 3, "mag": 0, "matk": 0, "eva": 1, "def": 2, "res": 0, "mdef": 0, "act": 3, "hp": 5, "mp": 2}, "侍": {"hit": 4, "atk": 3, "mag": 2, "matk": 0, "eva": 1, "def": 0, "res": 0, "mdef": 0, "act": 3, "hp": 5, "mp": 2}, "使徒": {"hit": 0, "atk": 0, "mag": 2, "matk": 2, "eva": 0, "def": 0, "res": 4, "mdef": 4, "act": 1, "hp": 1, "mp": 6}, "人造人間": {"hit": 3, "atk": 3, "mag": 0, "matk": 0, "eva": 0, "def": 4, "res": 0, "mdef": 3, "act": 0, "hp": 6, "mp": 1}, "侵魔召喚師": {"hit": 0, "atk": 0, "mag": 3, "matk": 3, "eva": 0, "def": 0, "res": 3, "mdef": 3, "act": 1, "hp": 2, "mp": 5}, "人狼": {"hit": 3, "atk": 4, "mag": 0, "matk": 0, "eva": 3, "def": 1, "res": 0, "mdef": 0, "act": 2, "hp": 6, "mp": 1}, "聖職者": {"hit": 1, "atk": 3, "mag": 1, "matk": 2, "eva": 0, "def": 1, "res": 2, "mdef": 3, "act": 0, "hp": 3, "mp": 4}, "仙人": {"hit": 2, "atk": 2, "mag": 3, "matk": 2, "eva": 0, "def": 0, "res": 2, "mdef": 2, "act": 0, "hp": 3, "mp": 4}, "転生者": {"hit": 2, "atk": 2, "mag": 1, "matk": 2, "eva": 1, "def": 2, "res": 1, "mdef": 2, "act": 0, "hp": 4, "mp": 3}, "同調者": {"hit": 2, "atk": 2, "mag": 2, "matk": 2, "eva": 1, "def": 1, "res": 1, "mdef": 1, "act": 1, "hp": 3, "mp": 4}, "忍者": {"hit": 3, "atk": 3, "mag": 0, "matk": 0, "eva": 3, "def": 0, "res": 0, "mdef": 0, "act": 4, "hp": 5, "mp": 2}, "箒騎士": {"hit": 2, "atk": 3, "mag": 1, "matk": 0, "eva": 2, "def": 1, "res": 2, "mdef": 1, "act": 1, "hp": 5, "mp": 2}, "魔剣使い": {"hit": 4, "atk": 3, "mag": 0, "matk": 0, "eva": 2, "def": 2, "res": 0, "mdef": 0, "act": 2, "hp": 5, "mp": 2}, "魔術師": {"hit": 0, "atk": 0, "mag": 4, "matk": 4, "eva": 0, "def": 0, "res": 3, "mdef": 2, "act": 0, "hp": 2, "mp": 5}, "魔物使い": {"hit": 3, "atk": 2, "mag": 0, "matk": 0, "eva": 0, "def": 3, "res": 2, "mdef": 3, "act": 0, "hp": 4, "mp": 3}, "勇者": {"hit": 2, "atk": 2, "mag": 2, "matk": 2, "eva": 1, "def": 1, "res": 1, "mdef": 1, "act": 1, "hp": 4, "mp": 3}, "夢使い": {"hit": 0, "atk": 0, "mag": 3, "matk": 3, "eva": 1, "def": 2, "res": 2, "mdef": 2, "act": 0, "hp": 2, "mp": 5}, "錬金術師": {"hit": 2, "atk": 2, "mag": 3, "matk": 3, "eva": 0, "def": 0, "res": 1, "mdef": 1, "act": 1, "hp": 2, "mp": 5}, "龍使い": {"hit": 3, "atk": 4, "mag": 0, "matk": 0, "eva": 2, "def": 4, "res": 0, "mdef": 0, "act": 0, "hp": 6, "mp": 1}};
const EQUIP_TYPES = ['武器', '防具', '箒', '魔装', 'その他'];

const abiKeys=["str","dex","agi","mnd","int","fai","per","luk"], abiNames={str:"筋力",dex:"器用",agi:"敏捷",mnd:"精神",int:"知力",fai:"信仰",per:"知覚",luk:"幸運"};
const combatKeys=["hit","atk","mag","matk","eva","def","res","mdef","act","move","hp","mp"], combatLabels={hit:"命中",atk:"攻撃",mag:"魔導",matk:"魔攻",eva:"回避",def:"防御",res:"抵抗",mdef:"魔防",act:"行動",move:"移動",hp:"HP",mp:"MP"};

createApp({setup(){
  const ui=reactive({showBasic:true,showPers:true,showAbi:true,showCombat:true,showEquip:true,showSkill:true,sortEquip:false,sortSkill:false});
  const meta=reactive({plName:"",password:"",name:"",element:"天／天",wclass:"異能者",sclass:"アタッカー",wlv:0,slv:0});
  const pers=reactive({race:"",alias:"",works:"",money:"",freeField:""});
  const prana=reactive({innerBase:0,innerMod:0,releaseBase:0,releaseMod:0,cfMod:0});
  const abi=reactive(abiKeys.reduce((o,k)=>{o[k]={base:10,mod:0};return o},{}));
  const combat=reactive({base:{hp:0,mp:0},skill:combatKeys.reduce((o,k)=>{o[k]=0;return o},{})});
  const equips=reactive([]),skills=reactive([]),portraitUrl=ref(""),fileEl=ref(null);

  const convNum = (val) => {
    if (typeof val !== 'string') val = String(val || 0);
    const s = val.replace(/[０-９]/g, (m) => String.fromCharCode(m.charCodeAt(0) - 0xFEE0));
    const n = parseInt(s, 10);
    return isNaN(n) ? 0 : n;
  };

  const abiTotal=k=>Number(abi[k].base)+Number(abi[k].mod);
  const cfBase=computed(()=>Math.floor(abiTotal('luk')/2));
  const pranaTotal=t=>{
    if(t==='inner') return Number(prana.innerBase)+Number(prana.innerMod);
    if(t==='release') return Number(prana.releaseBase)+Number(prana.releaseMod);
    if(t==='cf') return cfBase.value+Number(prana.cfMod);
    return 0;
  };
  const totalLevel=computed(()=>Number(meta.wlv)+Number(meta.slv));

  // Update Base Ability & HP/MP from Element
  const updateBase=()=>{
    const attr=ATTR_DATA[meta.element];
    if(!attr) return;
    // Set Abilities
    abiKeys.forEach(k => abi[k].base = attr.stats[k] || 0);
    // Set HP/MP Base
    combat.base.hp = attr.base.hp || 0;
    combat.base.mp = attr.base.mp || 0;
  };
  watch(()=>meta.element, updateBase, {immediate:true});

  // Calculate Base Combat Stats based on Rules
  const baseCombat = computed(() => {
    // 1. Calc from Abilities
    const str=abiTotal('str'), dex=abiTotal('dex'), agi=abiTotal('agi'), mnd=abiTotal('mnd');
    const int=abiTotal('int'), fai=abiTotal('fai'), per=abiTotal('per'), luk=abiTotal('luk');
    
    const c = {
        hit: Math.floor((dex + per) / 2),
        eva: Math.floor((agi + per) / 2),
        atk: Math.floor((str + dex) / 2),
        def: Math.floor((str + fai) / 2),
        mag: Math.floor((mnd + luk) / 2),
        res: Math.floor((agi + luk) / 2),
        matk: Math.floor((int + mnd) / 2),
        mdef: Math.floor((int + fai) / 2),
        act: Math.floor((str + agi + int + fai) / 3),
        hp: combat.base.hp,
        mp: combat.base.mp,
        move: 0
    };

    // 2. Add Class Modifiers
    const wData = CLASS_DATA[meta.wclass] || {};
    const sData = STYLE_DATA[meta.sclass] || {};
    const wLv = Number(meta.wlv), sLv = Number(meta.slv);

    ['hit','atk','mag','matk','eva','def','res','mdef','act','hp','mp'].forEach(k => {
        c[k] += (wData[k]||0) * wLv;
        c[k] += (sData[k]||0) * sLv;
    });

    // 3. Calc Move (based on unequipped Act)
    c.move = Math.floor(c.act / 10) + 1;

    return c;
  });

  const equipped=computed(()=>{
    const res={...baseCombat.value};
    equips.forEach(e => {
      if(e.equipped) {
          combatKeys.forEach(k => res[k] = Number(res[k]) + Number(e[k]||0));
      }
    });
    // Add Skill/Other Mods
    combatKeys.forEach(k => {
        res[k] = Number(res[k]) + Number(combat.skill[k]||0);
    });
    return res;
  });

  const equipCaps = computed(() => {
    const tl = totalLevel.value;
    const str = abiTotal('str');
    const int = abiTotal('int');
    const maxWeight = str + tl;
    const maxMem = int + tl;
    const maxTsuki = (str * 2) + tl;
    let currentWeight = 0, currentMem = 0, currentTsuki = 0;
    equips.forEach(e => {
      const w = Number(e.weight || 0);
      const isMagic = e.type === '魔装';
      if (e.equipped && !isMagic) currentWeight += w;
      if (isMagic) currentMem += w;
      if (!e.equipped && !isMagic) currentTsuki += w;
    });
    return { maxWeight, maxMem, maxTsuki, currentWeight, currentMem, currentTsuki };
  });

  const addRow=(list,type)=>{
    const obj={_k:Math.random()};
    if(type==='equip') Object.assign(obj,{equipped:true,name:"",type:'武器',part:"",weight:0,hit:0,atk:0,mag:0,matk:0,eva:0,def:0,res:0,mdef:0,act:0,move:0,hp:0,mp:0});
    else Object.assign(obj,{name:"",sl:1,timing:"",judge:"",target:"",range:"",cost:"",effect:""});
    list.push(obj);
  };
  const removeLast=list=>{if(list.length>1)list.pop()};
  const moveRow=(list,idx,dir)=>{
    const target=idx+dir;if(target<0||target>=list.length)return;
    const tmp=list[idx];list[idx]=list[target];list[target]=tmp;
  };

  const pickImage=()=>fileEl.value.click();
  const onFileChange=e=>{const f=e.target.files[0];if(f)portraitUrl.value=URL.createObjectURL(f)};
  const dummyAction=m=>alert(m);
  const resetData=()=>{if(confirm("データをすべてリセットしますか？")) location.reload()};

  for(let i=0;i<3;i++){addRow(equips,'equip');addRow(skills,'skill')}

  return{ui,meta,pers,prana,abi,combat,equips,skills,portraitUrl,fileEl,abiKeys,abiNames,combatKeys,combatLabels,abiTotal,cfBase,pranaTotal,totalLevel,baseCombat,equipped,equipCaps,addRow,removeLast,moveRow,pickImage,onFileChange,dummyAction,resetData,convNum,elementKeys:Object.keys(ATTR_DATA),wClassKeys:Object.keys(CLASS_DATA),sClassKeys:Object.keys(STYLE_DATA),equipTypes:EQUIP_TYPES};
}}).mount("#app");
</script></body></html>
